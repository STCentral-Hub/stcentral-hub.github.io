(()=>{"use strict";class e{constructor(e){this.accordion=e,this.transitionDuration=250}toggleAccordion(){this.accordion.classList.toggle("active");const e=this.accordion.nextElementSibling;e.style.transition=`height ${this.transitionDuration}ms ease-out`,"visible"===e.style.visibility?(e.style.height="0",e.style.display="block",setTimeout(()=>{e.style.display="none",e.style.visibility="collapse"},this.transitionDuration)):(e.style.display="block",e.style.visibility="visible",e.style.height=`${e.scrollHeight}px`,setTimeout(()=>{e.style.display="flex"},this.transitionDuration))}}window.accordionOnClick=t=>new e(t).toggleAccordion()})(),(()=>{"use strict";class t{static getPrecedentMap({precedentType:e}){let n={};return"hero-gear"===e&&(n=t.#e()),n}static#e(){return{"hero-class":{precedence:600,ignoreClasses:[],override:[]},"item-type":{precedence:500,ignoreClasses:[],override:[]},"item-tier":{precedence:400,ignoreClasses:[],override:[]},"element-matches-hero":{precedence:300,ignoreClasses:[],override:[200,100]},"item-stat":{precedence:200,ignoreClasses:[],override:[]},element:{precedence:100,ignoreClasses:["no-element","no-spirit","has-matching-affinity"],override:[]},spirit:{precedence:100,ignoreClasses:["no-element","no-spirit","has-matching-affinity"],override:[]}}}}const n=t;class e{static optionGroupClass="js-filter-option-group";static optionGroupPrefix="js-filter-precedent-type-";static optionClass="js-filter-option";static optionPrefix="js-filter-precedent-";constructor({document:e,filterPrecedence:t=n,type:s}){this.document=e,this.filterVisibleClass="js-autocomplete-display-row",this.filterCollapsedClass="js-autocomplete-collapse-row",this.precedenceMap=t.getPrecedentMap({precedentType:s}),this.toggledFilterIds={}}handleOptionClick({element:e}){this.toggledFilterIds={changed:new Set,unchanged:new Set},this.#t({element:e}),this.#s({element:e}),this.#n()}#r({element:e}){e.classList.add(this.filterCollapsedClass),e.classList.remove(this.filterVisibleClass)}#l({element:e}){e.classList.add(this.filterVisibleClass),e.classList.remove(this.filterCollapsedClass)}#t({element:t}){if("radio"===t.type){let n=!0;const s=this.document.getElementsByClassName(e.optionGroupClass);for(let o=0;o<s.length;o++){const a=s[o],r=this.#i({element:t}).precedence,i=a.getElementsByClassName(e.optionClass);for(let e=0;e<i.length;e++){const s=i[e];r>this.#i({element:s}).precedence&&t.id!==s.id&&s.checked&&(n=!1)}}n&&(t.checked=!1)}}#s({element:t}){const n=this.#i({element:t});this.#c({changed:!0,element:t,precedence:n});const s=this.document.getElementsByClassName(e.optionGroupClass);for(let o=0;o<s.length;o++){const i=s[o].getElementsByClassName(e.optionClass);for(let o=0;o<i.length;o++){const e=i[o],s=this.#i({element:e});t.id!==e.id&&("radio"===t.type&&n.precedence>=s.precedence?(e.checked=!t.checked,this.#c({changed:!0,element:e,precedence:s})):"radio"===e.type&&n.precedence<s.precedence?(e.checked=!1,this.#c({changed:!0,element:e,precedence:s})):this.#c({changed:!1,element:e,precedence:s}))}}}#n(){const t=Array.from(this.toggledFilterIds.changed.values()),n=Array.from(this.toggledFilterIds.unchanged.values());t.forEach(s=>{const o=this.document.getElementsByClassName(s.key);for(let s=0;s<o.length;s++){const i=o[s].parentElement;let a={};const r=i.children;for(let s=0;s<r.length;s++){const o=r[s];a=Array.from(o.classList).reduce((s,o)=>e.#d({changedFilters:t,cls:o,result:s,unchangedFilters:n}),a)}e.#a({precedenceState:a})?this.#l({element:i}):this.#r({element:i})}})}#c({element:t,changed:n,precedence:s}){const o={checked:t.checked,key:e.#o({elementId:t.id}),precedence:s};n?this.toggledFilterIds.changed.add(o):this.toggledFilterIds.unchanged.add(o)}#i({element:t}){const n=Array.from(t.classList).find(t=>t.startsWith(e.optionPrefix)).replace(e.optionPrefix,"");return this.precedenceMap[n]}static#o({elementId:e}){return e.replace(/^(?:\w+-)+option-/u,"")}static#d({result:e,cls:t,changedFilters:n,unchangedFilters:s}){const o=n.find(e=>e.key===t),i=s.find(e=>e.key===t);if(o||i){const a=o?o.checked:i.checked,{precedence:n,ignoreClasses:r,override:s}=o?o.precedence:i.precedence;return e[n]||(e[n]={},e[n].classes={disabled:new Set,enabled:new Set},e[n].ignoreClasses=new Set),i&&r.filter(e=>e===t).forEach(t=>e[n].ignoreClasses.add(t)),a?(e[n].classes.enabled.add(t),s.forEach(t=>{e[t]||(e[t]={},e[t].classes={disabled:new Set,enabled:new Set},e[t].ignoreClasses=new Set),e[t].isOverridden=!0})):(e[n].classes.disabled.add(t),s.length>0&&(e[n].skipOverride=!0)),e}return e}static#a({precedenceState:e}){return Object.keys(e).sort().reverse().reduce((t,n)=>{if(!1===t)return t;const s=e[n];if(s.isOverridden||s.skipOverride)return t;const o=s.classes.enabled;if(0===o.size)return!1;const i=s.classes.disabled,a=s.ignoreClasses,r=Array.from(o).filter(e=>a.has(e));if(o.size===r.length&&i.size>0){const e=Array.from(i).filter(e=>a.has(e));if(i.size!==e.length)return!1}return t},!0)}}const s=new e({document:window.document,type:"hero-gear"});window.autocompleteOptionOnClick=(e,t)=>s.handleOptionClick({element:e,parentClassKey:t})})(),(()=>{"use strict";class e{constructor(e){this.slot=e,this.transitionDuration=250}toggleSlotDetails(){const i=document.getElementsByClassName("hero-equipment-slot");let e=null,t=null,n=null,s=null;for(const o of i)o.style.transition=[`border-radius ${this.transitionDuration}ms ease-in-out`,`border-bottom-color ${this.transitionDuration}ms ease-in-out`].join(", "),o.id===this.slot.id?(e=this.#t(o),e&&(t=e.parentElement,e.style.transition=`max-height ${this.transitionDuration}ms ease-out`,t&&(t.style.transition=`max-height ${this.transitionDuration}ms ease-out`))):[n,s]=this.#s(o);const o=this.slot.classList.contains("active-slot");o?(n&&(n.style.maxHeight="0"),s&&(s.style.maxHeight="0"),setTimeout(()=>{n&&(n.innerHTML="",n.classList.remove("active-slot-details")),s&&s.classList.remove("active-slot-details")},this.transitionDuration),e&&t&&setTimeout(()=>{e.innerHTML=this.slot.title.split(`
`).map(e=>`<p class="st-text-outline-p no-margin">${e}</p>`).join(""),e.classList.add("active-slot-details"),t.classList.add("active-slot-details"),e.style.maxHeight=`${e.scrollHeight}px`,t.style.maxHeight=`${t.scrollHeight+e.scrollHeight}px`},this.transitionDuration)):(e&&(e.style.maxHeight="0"),t&&(t.style.maxHeight="0"),setTimeout(()=>{!o&&e&&(e.innerHTML="",e.classList.remove("active-slot-details")),!o&&t&&t.classList.remove("active-slot-details")},this.transitionDuration))}#s(e){e.classList.remove("active-slot");let t=null,n=null;const s=document.getElementsByClassName("hero-equipment-slot-details-wrapper");for(const o of s){let e=!1;const i=o.children;for(const n of i)e=!!e||n.classList.contains(this.slot.id),n.classList.contains("active-slot-details")&&!n.classList.contains(this.slot.id)&&(t=n);n=e?null:o}return[t,n]}#t(e){e.classList.toggle("active-slot");let t=null;const n=document.getElementsByClassName(this.slot.id);for(const s of n)s.classList!==e.classList&&(t=s);return t}}const t=new class{constructor({clipboard:e,console:t}){this.clipboard=e,this.logger=t}copyHeroSimString({sim:e}){this.clipboard.writeText(e).then(()=>{this.logger.log(`Copied the text:
${e}`)})}}({clipboard:window.navigator.clipboard,console});window.copySimString=e=>t.copyHeroSimString({sim:e}),window.heroSlotOnClick=t=>new e(t).toggleSlotDetails()})(),(()=>{"use strict";class l{static LANGUAGES=["en","fr","es","de","it","pt","ru","tk","zh","zh_tr","ja","ko","uk"];static getLocale({window:e}){let t=e.location.pathname.split("/")[1];return l.LANGUAGES.includes(t)||(t="en"),"zh_tr"===t&&(t="zh-Hant"),t}}class t{static LOCAL="localStorage";static SESSION="sessionStorage";static STORAGE_KEYS={SHOP:"shop",TALENTS:"talents",USE_LOCAL_STORAGE:"useLocalStorage"};constructor({window:e}){this.window=e}save({key:e,value:n,storageType:s}){s!==t.LOCAL&&s!==t.SESSION||this.window[s].setItem(e,n)}load({key:e,storageType:t}){return this.window[t].getItem(e)??""}clearData(){this.window[t.LOCAL].clear(),this.window[t.SESSION].clear()}isStorageAvailable(e){if(e!==t.LOCAL&&e!==t.SESSION)return!1;let n=null;try{n=this.window[e];const t="__storage_test__";return n.setItem(t,t),n.removeItem(t),!0}catch(e){const t={firefox:1014,notFirefox:22};return e instanceof this.window.DOMException&&(e.code===t.notFirefox||e.code===t.firefox||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&n&&0!==n.length}}}class c{static STORAGE_MODE_TOGGLEBOX_ID="storage-mode-togglebox";constructor({window:e,popup:n,storage:s}){this.document=e.document,this.popup=n,this.popupId="",this.storage=s,this.storageType=t.SESSION}saveSetting({id:e}){if(e===c.STORAGE_MODE_TOGGLEBOX_ID){const n=this.document.getElementById(e).checked;this.storage.save({key:t.STORAGE_KEYS.USE_LOCAL_STORAGE,storageType:t.LOCAL,value:n})}}load(){const e=this.#e({elementId:c.STORAGE_MODE_TOGGLEBOX_ID,key:t.STORAGE_KEYS.USE_LOCAL_STORAGE});this.storageType=e?t.LOCAL:t.SESSION}onClickToggleSettingsPopup({event:e,id:t}){t?(this.popupId=t,this.popup.open({popupId:this.popupId})):this.popupId&&e.target===this.document.getElementById(this.popupId)&&(this.popup.close({popupId:this.popupId}),this.popupId="")}#e({elementId:e,key:n}){const o=this.storage.load({key:n,storageType:t.LOCAL}),s=this.document.getElementById(e);return o.match(/true/iu)?s.checked=!0:o.match(/false/iu)&&(s.checked=!1),s.checked}}class e{static LIMITS={COUNTER_ENERGY:32,FURNITURE:{LEVEL:{max:25,min:1},QUANTITY:{COUNTER:{max:1,min:1},TRUNKS:{max:5,min:0},max:87,min:0}},PERKS:{RACK_ENERGY_LEVEL:{max:7,min:0}}};static FURNITURE_TYPES={BAR_ID:"furniture-bar",COUNTER:{BAR:{color:"#FF1F00",id:"counter-bar"},TYPES:["counter"]},RACKS:{BAR:{color:"#F3CA00",id:"rack-bar"},TYPES:["mannequins","shelves","tables","verticalracks"]},RSS:{BAR:{color:"#40FF72",id:"bin-bar"},T1:["ironBin","woodBin","leatherBin","herbBin"],T2:["steelBin","ironwoodBin","fabricBin","oilBin"],T3:["etherBin","jewelBin"],T4:["essenceBin"]},TRUNKS:{BAR:{color:"#9000FF",id:"trunk-bar"},TYPES:["trunks"]}};static PERK_TYPES={ENERGY:["mannequinsPerkLevel","shelvesPerkLevel","tablesPerkLevel","verticalracksPerkLevel"]};constructor(){this.furniture={counter:[{level:1,quantity:1}],essenceBin:[{level:1,quantity:0}],etherBin:[{level:1,quantity:0}],fabricBin:[{level:1,quantity:0}],herbBin:[{level:1,quantity:0}],ironBin:[{level:1,quantity:0}],ironwoodBin:[{level:1,quantity:0}],jewelBin:[{level:1,quantity:0}],leatherBin:[{level:1,quantity:0}],mannequins:[{level:1,quantity:0}],oilBin:[{level:1,quantity:0}],shelves:[{level:1,quantity:0}],steelBin:[{level:1,quantity:0}],tables:[{level:1,quantity:0}],trunks:[{level:1,quantity:0}],verticalracks:[{level:1,quantity:0}],woodBin:[{level:1,quantity:0}]},this.guildPerks={mannequinsPerkLevel:0,shelvesPerkLevel:0,tablesPerkLevel:0,verticalracksPerkLevel:0}}loadShop({shopObject:e}){this.#t({shopObj:e}),this.#i({shopObj:e})}#t({shopObj:e}){const{guildPerks:t}=this;if(e.guildPerks){const n=e.guildPerks;t.mannequinsPerkLevel=n.mannequinsPerkLevel??t.mannequinsPerkLevel,t.shelvesPerkLevel=n.shelvesPerkLevel??t.shelvesPerkLevel,t.tablesPerkLevel=n.tablesPerkLevel??t.tablesPerkLevel,t.verticalracksPerkLevel=n.verticalracksPerkLevel??t.verticalracksPerkLevel}}#i({shopObj:e}){const{furniture:t}=this;if(e.furniture){const n=e.furniture;t.counter=n.counter??t.counter,t.essenceBin=n.essenceBin??t.essenceBin,t.etherBin=n.etherBin??t.etherBin,t.fabricBin=n.fabricBin??t.fabricBin,t.herbBin=n.herbBin??t.herbBin,t.ironBin=n.ironBin??t.ironBin,t.ironwoodBin=n.ironwoodBin??t.ironwoodBin,t.jewelBin=n.jewelBin??t.jewelBin,t.leatherBin=n.leatherBin??t.leatherBin,t.mannequins=n.mannequins??t.mannequins,t.oilBin=n.oilBin??t.oilBin,t.shelves=n.shelves??t.shelves,t.steelBin=n.steelBin??t.steelBin,t.tables=n.tables??t.tables,t.verticalracks=n.verticalracks??t.verticalracks,t.woodBin=n.woodBin??t.woodBin,n.trunks&&(n.trunks.length>1||n.trunks[0]&&n.trunks[0].quantity>0)&&(t.trunks=n.trunks)}}}class h{constructor({barId:e,document:t,slices:n}){this.barElement=t.getElementById(e),this.barSummaryElement=t.getElementById(`${e}-summary`),this.document=t,this.segments={},this.slices=n,this.usedSlices=0}addSegment({id:e,name:t,value:n,color:s}){this.segments[e]={color:s,name:t,value:n},this.usedSlices+=n,this.#n({id:e,isDeleted:!1}),this.#s()}updateSegmentValue({id:e,value:t}){this.segments[e]&&(this.usedSlices=this.usedSlices-this.segments[e].value+t,this.segments[e].value=t,this.#n({id:e,isDeleted:!1}),this.#s())}removeSegment({id:e}){this.segments[e]&&(this.usedSlices-=this.segments[e].value,delete this.segments[e],this.#n({id:e,isDeleted:!0}),this.#s())}#n({id:e,isDeleted:t}){let n=this.document.getElementById(e);if(t)n&&this.barElement.removeChild(n);else{const t=this.segments[e];n||(n=this.document.createElement("div"),n.id=e,n.style.backgroundColor=t.color),n.title=`${t.name}: ${t.value}`,n.style.width=t.value/this.slices*100+"%",this.barElement.appendChild(n)}}#s(){this.barSummaryElement.innerText=`${this.usedSlices} / ${this.slices}`}}class s{static hideAddButtonClass="furniture-table-hide-add-row";static roundBottomBorderCorners="furniture-table-tbody-is-last-row";constructor({document:e,shopManager:t}){this.document=e,this.shopManager=t}#r({name:t,placeholder:n,row:s}){const i=n.toLowerCase(),o=this.document.createElement("INPUT");return o.setAttribute("type","number"),o.setAttribute("name",t),o.setAttribute("placeholder",n),o.setAttribute("autocomplete",!1),o.setAttribute("min","level"===i?e.LIMITS.FURNITURE.LEVEL.min:e.LIMITS.FURNITURE.QUANTITY.min),o.setAttribute("max","level"===i?e.LIMITS.FURNITURE.LEVEL.max:e.LIMITS.FURNITURE.QUANTITY.max),o.setAttribute("value","level"===i?s.level:s.quantity),o.classList.add("furniture-table-input-spinner"),o.classList.add(`furniture-table-input-${i}`),o.onchange=t=>{const o={id:s.id},n=parseInt(t.target.value,10);"level"===i?isNaN(n)||n<e.LIMITS.FURNITURE.LEVEL.min?o.level=e.LIMITS.FURNITURE.LEVEL.min:n>e.LIMITS.FURNITURE.LEVEL.max?o.level=e.LIMITS.FURNITURE.LEVEL.max:o.level=n:isNaN(n)||n<e.LIMITS.FURNITURE.QUANTITY.min?o.quantity=e.LIMITS.FURNITURE.QUANTITY.min:n>e.LIMITS.FURNITURE.QUANTITY.max?o.quantity=e.LIMITS.FURNITURE.QUANTITY.max:o.quantity=n,this.shopManager.editFurniture(o)},o}#a({rowId:e}){const t=this.document.createElement("BUTTON");return t.appendChild(this.document.createTextNode("X")),t.onclick=()=>this.shopManager.removeFurniture({id:e}),t}static#l({rowElement:e,element:t}){e.insertCell(-1).appendChild(t)}addRow({id:t,level:n,quantity:o}){const i={id:t,level:n,quantity:o},a=this.document.getElementById(i.id.replace(/-\d+$/u,""));if(a){const t=a.insertRow(-1);t.id=i.id,a.rows.length>=e.LIMITS.FURNITURE.LEVEL.max&&(a.classList.add(s.roundBottomBorderCorners),a.nextElementSibling.classList.add(s.hideAddButtonClass));const n=this.#r({name:"level",placeholder:"Level",row:i}),o=this.#r({name:"quantity",placeholder:"Quantity",row:i}),r=this.#a({rowId:i.id});s.#l({element:n,rowElement:t}),s.#l({element:o,rowElement:t}),s.#l({element:r,rowElement:t})}}deleteRow({rowId:e}){const n=this.document.getElementById(e),t=this.document.getElementById(e.replace(/-\d+$/u,""));if(!n||!t||n===t)return;const o=t.nextElementSibling;o.classList.contains(s.hideAddButtonClass)&&(t.classList.remove(s.roundBottomBorderCorners),o.classList.remove(s.hideAddButtonClass)),t.deleteRow(n.rowIndex-1)}loadGuildPerk({id:e,level:t}){this.document.getElementById(e).value=t}}class r{#o={};#c="en";constructor({document:e,locale:t}){this.#o=e,this.#c=t,this.mannequinsEnergy=0,this.shelvesEnergy=0,this.tablesEnergy=0,this.verticalracksEnergy=0,this.mannequinsPerkEnergy=0,this.shelvesPerkEnergy=0,this.tablesPerkEnergy=0,this.verticalracksPerkEnergy=0,this.rackEnergy=0,this.perkEnergy=0,this.talentEnergy=0,this.energy=0}calculateShopEnergy({shop:t,talents:n}){this.rackEnergy=0,this.perkEnergy=0,e.FURNITURE_TYPES.RACKS.TYPES.forEach(n=>{const s=`${n}Energy`,o=e.PERK_TYPES.ENERGY.find(e=>e.replace(/PerkLevel$/u,"")===n),i=o.replace(/Level$/u,"Energy");this[s]=t.furniture[n].reduce(r.#u,0),this[i]=r.#d(t.furniture[n],t.guildPerks[o]),this.rackEnergy+=this[s],this.perkEnergy+=this[i]});const i=r.#h(t.furniture.counter[0].level),a=r.#E(n.bartering.energetic.level),c=r.#T(n.bartering.hyper.level),s=(e.LIMITS.COUNTER_ENERGY+this.rackEnergy+this.perkEnergy)*i,o=(s+a)*c;this.talentEnergy=Math.round(o-s),this.energy=Math.floor(o)}setInputLevel({id:e,level:t,max:n,min:s}){const o=this.#o.getElementById(e);o&&(o.max=n,o.min=s,o.value=t)}setEnergyElements(){this.#o.getElementById("mannequins-energy").innerText=this.mannequinsEnergy.toLocaleString(this.#c),this.#o.getElementById("mannequins-perk-energy").innerText=this.mannequinsPerkEnergy.toLocaleString(this.#c),this.#o.getElementById("shelves-energy").innerText=this.shelvesEnergy.toLocaleString(this.#c),this.#o.getElementById("shelves-perk-energy").innerText=this.shelvesPerkEnergy.toLocaleString(this.#c),this.#o.getElementById("tables-energy").innerText=this.tablesEnergy.toLocaleString(this.#c),this.#o.getElementById("tables-perk-energy").innerText=this.tablesPerkEnergy.toLocaleString(this.#c),this.#o.getElementById("verticalracks-energy").innerText=this.verticalracksEnergy.toLocaleString(this.#c),this.#o.getElementById("verticalracks-perk-energy").innerText=this.verticalracksPerkEnergy.toLocaleString(this.#c),this.#o.getElementById("shop-rack-energy").innerText=this.rackEnergy.toLocaleString(this.#c),this.#o.getElementById("shop-perk-energy").innerText=this.perkEnergy.toLocaleString(this.#c),this.#o.getElementById("shop-talent-energy").innerText=this.talentEnergy.toLocaleString(this.#c),this.#o.getElementById("shop-energy").innerText=this.energy.toLocaleString(this.#c)}static#u(e,t){return e+r.#g(t.level)*t.quantity}static#d(e,t){return e.reduce((e,t)=>e+t.quantity,0)*t*2}static#h(e){let t=1;switch(e){case 16:t=1.01;break;case 17:t=1.02;break;case 18:t=1.03;break;case 19:t=1.04;break;case 20:t=1.05;break;case 21:t=1.06;break;case 22:t=1.07;break;case 23:t=1.08;break;case 24:t=1.09;break;case 25:t=1.1}return t}static#g(e){let t=9;switch(e){case 2:t=12;break;case 3:t=15;break;case 4:t=18;break;case 5:t=21;break;case 6:t=24;break;case 7:t=30;break;case 8:t=36;break;case 9:t=42;break;case 10:t=48;break;case 11:t=54;break;case 12:t=63;break;case 13:t=72;break;case 14:t=81;break;case 15:t=90;break;case 16:t=99;break;case 17:t=110;break;case 18:t=121;break;case 19:t=132;break;case 20:t=143;break;case 21:t=154;break;case 22:t=166;break;case 23:t=178;break;case 24:t=190;break;case 25:t=202}return t}static#E(e){let t=0;switch(e){case 1:t=10;break;case 2:t=20;break;case 3:t=30;break;case 4:t=40;break;case 5:t=50}return t}static#T(e){let t=1;switch(e){case 1:t=1.02;break;case 2:t=1.04;break;case 3:t=1.06;break;case 4:t=1.08;break;case 5:t=1.1}return t}}class n{static LIMITS={BARTERING:{ENERGETIC:{max:5,min:0},HYPER:{max:5,min:0}}};static TALENTS={BARTERING:["bartering-energetic","bartering-hyper"]};constructor(){this.bartering={energetic:{level:n.LIMITS.BARTERING.ENERGETIC.min},hyper:{level:n.LIMITS.BARTERING.HYPER.min}}}loadTalents({talentObject:e}){this.#S({barteringTree:e.bartering})}#S({barteringTree:e}){e&&(this.bartering.energetic=e.energetic??this.bartering.energetic,this.bartering.hyper=e.hyper??this.bartering.hyper)}}class o{constructor({locale:t,shop:n,storage:o,storageType:i,talentManager:a,window:c}){this.shop=n,this.storage=o,this.storageType=i,this.talentManager=a,this.window=c;const l=e.LIMITS.FURNITURE.QUANTITY;this.furnitureBar=new h({barId:e.FURNITURE_TYPES.BAR_ID,document:c.document,slices:l.max+l.COUNTER.min+l.TRUNKS.min}),this.furnitureTable=new s({document:c.document,shopManager:this}),this.shopEnergy=new r({document:c.document,locale:t})}onLoad(){const s=this.storage.load({key:t.STORAGE_KEYS.SHOP,storageType:this.storageType});if(""!==s){const e=JSON.parse(s);this.shop.loadShop({shopObject:e})}Object.keys(this.shop.furniture).forEach(e=>{o.#p(this.shop.furniture[e]),this.shop.furniture[e].forEach((t,n)=>{t.id||(t.id=`${e}-table-body-${n}`);const s={id:t.id,level:t.level,quantity:t.quantity};this.addFurniture(s)})}),Object.keys(this.shop.guildPerks).forEach(e=>{const t=e.replace(/PerkLevel$/u,"-perk-level");this.furnitureTable.loadGuildPerk({id:t,level:this.shop.guildPerks[e]})}),this.shopEnergy.setInputLevel({id:"counter-level",level:this.shop.furniture.counter[0].level,max:e.LIMITS.FURNITURE.LEVEL.max,min:e.LIMITS.FURNITURE.LEVEL.min}),this.shopEnergy.setInputLevel({id:n.TALENTS.BARTERING[0],level:this.talentManager.talents.bartering.energetic.level,max:n.LIMITS.BARTERING.ENERGETIC.max,min:n.LIMITS.BARTERING.ENERGETIC.min}),this.shopEnergy.setInputLevel({id:n.TALENTS.BARTERING[1],level:this.talentManager.talents.bartering.hyper.level,max:n.LIMITS.BARTERING.HYPER.max,min:n.LIMITS.BARTERING.HYPER.min}),this.#m(),this.#R()}addFurniture({id:e,level:t=1,quantity:n=0}){if(!o.#I({id:e}))return;const i={id:e,level:t,quantity:n},a=o.#y({id:e}),s=this.shop.furniture[a];if(!s.find(t=>t.id===e))if(e.match(/-\d+$/u))s.push(i);else{const t=s.map(e=>{const t=e.id.replace(/^.*-(?<index>\d+)$/u,"$<index>");return parseInt(t,10)}).sort((e,t)=>e-t).reduce((e,t,n,s)=>e<s.length?e:t!==n?n:e,s.length);i.id=`${e}-${t}`,s.push(i)}this.furnitureTable.addRow({...i})}removeFurniture({id:t}){if(!o.#I({id:t}))return;const n=o.#y({id:t}),s=this.shop.furniture[n],i=s.find(e=>e.id===t),a=s.indexOf(i);s.splice(a,1),this.#v(),this.#k({furnitureType:n}),this.furnitureTable.deleteRow({rowId:t}),e.FURNITURE_TYPES.RACKS.TYPES.includes(n)&&this.#m()}editFurniture({id:e,level:t=-1,quantity:n=-1}){if(!o.#I({id:e})&&!e.endsWith("-table-body"))return;const s=o.#y({id:e}),i=this.shop.furniture[s].find(t=>t.id===e);t>-1&&(i.level=t),n>-1&&(i.quantity=n,this.#k({furnitureType:s})),this.#v(),this.#m()}editPerk({id:t,value:n}){if(!o.#I({id:t}))return;const i=t.replace(/-perk-level$/u,"PerkLevel"),s=parseInt(n,10),a=e.LIMITS.PERKS.RACK_ENERGY_LEVEL.min,r=e.LIMITS.PERKS.RACK_ENERGY_LEVEL.max;isNaN(s)||s<a?this.shop.guildPerks[i]=a:this.shop.guildPerks[i]=s>r?r:s,this.#v(),this.#m()}editCounter({id:t,value:n}){if("counter-level"!==t)return;const o=this.shop.furniture.counter[0],s=parseInt(n,10),i=e.LIMITS.FURNITURE.LEVEL.min,a=e.LIMITS.FURNITURE.LEVEL.max;isNaN(s)||s<i?o.level=i:o.level=s>a?a:s,this.#v(),this.#m()}#v(){const n={...this.shop},s={};Object.keys(this.shop.furniture).forEach(t=>{s[t]=this.shop.furniture[t].reduce((t,n)=>{const o={level:n.level,quantity:n.quantity},s=t.find(e=>e.level===o.level);return s?(s.quantity+=o.quantity,s.quantity>e.LIMITS.FURNITURE.QUANTITY.max&&(s.quantity=e.LIMITS.FURNITURE.QUANTITY.max)):t.push(o),t},[])}),n.furniture=s,this.storage.save({key:t.STORAGE_KEYS.SHOP,storageType:this.storageType,value:JSON.stringify(n)})}#m(){this.shopEnergy.calculateShopEnergy({shop:this.shop,talents:this.talentManager.talents}),this.shopEnergy.setEnergyElements({window:this.window})}#R(){const s=this.shop.furniture.counter[0].quantity,o=this.shop.furniture.trunks.reduce((e,t)=>e+t.quantity,0);let t=0,n=0;e.FURNITURE_TYPES.RACKS.TYPES.forEach(e=>{t+=this.shop.furniture[e].reduce((e,t)=>e+t.quantity,0)}),[...e.FURNITURE_TYPES.RSS.T1,...e.FURNITURE_TYPES.RSS.T2,...e.FURNITURE_TYPES.RSS.T3,...e.FURNITURE_TYPES.RSS.T4].forEach(e=>{n+=this.shop.furniture[e].reduce((e,t)=>e+t.quantity,0)}),this.furnitureBar.addSegment({color:e.FURNITURE_TYPES.COUNTER.BAR.color,id:e.FURNITURE_TYPES.COUNTER.BAR.id,name:"Counter",value:s}),this.furnitureBar.addSegment({color:e.FURNITURE_TYPES.TRUNKS.BAR.color,id:e.FURNITURE_TYPES.TRUNKS.BAR.id,name:"Trunks",value:o}),this.furnitureBar.addSegment({color:e.FURNITURE_TYPES.RSS.BAR.color,id:e.FURNITURE_TYPES.RSS.BAR.id,name:"Bins",value:n}),this.furnitureBar.addSegment({color:e.FURNITURE_TYPES.RACKS.BAR.color,id:e.FURNITURE_TYPES.RACKS.BAR.id,name:"Racks",value:t})}#k({furnitureType:t}){const o=e.FURNITURE_TYPES.RACKS.TYPES,i=[...e.FURNITURE_TYPES.RSS.T1,...e.FURNITURE_TYPES.RSS.T2,...e.FURNITURE_TYPES.RSS.T3,...e.FURNITURE_TYPES.RSS.T4];let n="",s=0;o.includes(t)?(n=e.FURNITURE_TYPES.RACKS.BAR.id,e.FURNITURE_TYPES.RACKS.TYPES.forEach(e=>{s+=this.shop.furniture[e].reduce((e,t)=>e+t.quantity,0)})):i.includes(t)?(n=e.FURNITURE_TYPES.RSS.BAR.id,[...e.FURNITURE_TYPES.RSS.T1,...e.FURNITURE_TYPES.RSS.T2,...e.FURNITURE_TYPES.RSS.T3,...e.FURNITURE_TYPES.RSS.T4].forEach(e=>{s+=this.shop.furniture[e].reduce((e,t)=>e+t.quantity,0)})):"trunks"===t&&(n=e.FURNITURE_TYPES.TRUNKS.BAR.id,s=this.shop.furniture.trunks.reduce((e,t)=>e+t.quantity,0)),n&&this.furnitureBar.updateSegmentValue({id:n,value:s})}static#p(e){e.sort((e,t)=>e.level-t.level==0?e.quantity-t.quantity:t.level-e.level)}static#I({id:t}){const n=/-table-body-?\d*$|-perk-level$/u;if(t.match(n)){const s=t.replace(n,"");if([...e.FURNITURE_TYPES.COUNTER.TYPES,...e.FURNITURE_TYPES.TRUNKS.TYPES,...e.FURNITURE_TYPES.RACKS.TYPES,...e.FURNITURE_TYPES.RSS.T1,...e.FURNITURE_TYPES.RSS.T2,...e.FURNITURE_TYPES.RSS.T3,...e.FURNITURE_TYPES.RSS.T4].includes(s)||e.PERK_TYPES.ENERGY.includes(`${s}PerkLevel`))return!0}return!1}static#y({id:e}){return e.replace(/-table-body-?\d*$/u,"")}editTalent({id:e,value:t}){n.TALENTS.BARTERING.includes(e)&&(this.talentManager.updateTalent({id:e,level:parseInt(t,10)}),this.#m())}}class d{constructor({storage:e,storageType:t,talents:n,window:s}){this.talents=n,this.storage=e,this.storageType=t,this.window=s}onLoad(){const e=this.storage.load({key:t.STORAGE_KEYS.TALENTS,storageType:this.storageType});if(""!==e){const t=JSON.parse(e);this.talents.loadTalents({talentObject:t})}}updateTalent({id:e,level:t}){const[s,o]=e.split("-");if(!(s&&o&&this.talents[s]&&this.talents[s][o]))return;const a=n.LIMITS[s.toUpperCase()][o.toUpperCase()];let i=t;t<0?i=0:t>a&&(i=a),this.talents[s][o].level=i,this.#L()}#L(){this.storage.save({key:t.STORAGE_KEYS.TALENTS,storageType:this.storageType,value:JSON.stringify(this.talents)})}}const u=new class{classes={popupActive:"popup-active"};constructor({window:e}){this.document=e.document}open({popupId:e}){this.document.getElementById(e).classList.add(this.classes.popupActive)}close({popupId:e}){this.document.getElementById(e).classList.remove(this.classes.popupActive)}}({window}),a=new t({window}),m=new class{classes={toggleboxActive:"togglebox-active",toggleboxInactive:"togglebox-inactive"};constructor({window:e}){this.document=e.document}click({id:e}){const s=this.document.getElementById(e),t=this.document.getElementById(`${e}-active`),n=this.document.getElementById(`${e}-inactive`);s.checked?(this.#B(t),this.#U(n)):(this.#B(n),this.#U(t))}#B(e){e&&(e.classList.add(this.classes.toggleboxActive),e.classList.remove(this.classes.toggleboxInactive))}#U(e){e&&(e.classList.remove(this.classes.toggleboxActive),e.classList.add(this.classes.toggleboxInactive))}}({window}),i=new c({popup:u,storage:a,window});window.onClickToggleBox=e=>{m.click({id:e}),a.isStorageAvailable(t.LOCAL)&&i.saveSetting({id:e})},window.onClickClearStorage=()=>{a.clearData(),a.isStorageAvailable(t.LOCAL)&&i.saveSetting({id:c.STORAGE_MODE_TOGGLEBOX_ID})},window.onClickOpenSettings=e=>i.onClickToggleSettingsPopup({event:null,id:e}),window.onclick=e=>i.onClickToggleSettingsPopup({event:e,id:""}),window.onload=()=>{a.isStorageAvailable(t.LOCAL)&&(i.load(),window.onClickToggleBox(c.STORAGE_MODE_TOGGLEBOX_ID)),a.isStorageAvailable(i.storageType)&&window.location.pathname.match(/(?:\/\w{2}|\/\w{2}_\w{2})?\/tools\/shop-sim\//u)&&function(){const r=l.getLocale({window}),t=new d({storage:a,storageType:i.storageType,talents:new n,window});t.onLoad();const s=new o({locale:r,shop:new e,storage:a,storageType:i.storageType,talentManager:t,window});s.onLoad(),window.shopManager=s}()}})()